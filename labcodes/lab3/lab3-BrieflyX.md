# Lab3 Report
# 高齐琦 P14206034

## 练习1

设计过程：首先将页表项取出判断是否为0，如果为0则说明页未被分配，此时调用alloc_page来填写页表项。而如果其不为0则说明是被换出到磁盘上，此时它的地址位表示磁盘扇区，故用swap_in将其调入内存中。

1. 页表项中的PTE_P、PTE_W、PTE_U这些标志位可以用来识别触发缺页异常的类型，是越权访问还是缺页。在实现页替换算法时，PTE_A与PTE_D位可以用来记录是否被访问过、是否被改写过，可以用于选择换出的页。

2. 再次触发缺页异常，将现场保存，进入double fault处理例程。

## 练习2

FIFO的实现比较简单，每次当alloc一个页时就将其添加到pra_list中head指针的前面，由于其是一个循环链表，这样做其实就是将其加入了链表的尾部。而换出victim时则直接剔除紧跟head之后的一页即可。

现有的框架足以支持实现extended clock，实现的方法与fifo类似，利用lab3中已经建立的pra_list循环链表，加上页表项中的PTE_A(accessed)与PTE_D(dirty)位可以表示页是否被访问过和写过作为标志位。需要解决的问题是在swap_manager中访问这个标志位，即取得实际页面与页表项的对应关系，同时可以修改这个标志位。

1. 需要被换出的页的特征是什么：在链表中的最靠前的未被访问过和写过的页面。
2. 在ucore中如何判断具有这样特征的页：利用pra_list环形链表的遍历，page节点中的PTE_A表示访问位，PTE_D表示写入位。
3. 由于ucore采用的是消极替换策略，故换入换出的时机总是在缺页时。

## 与参考答案的区别

基本也只是实现细节方面的不同，答案中是将page插入到链表head的后面，替换时选择head的前一个page作为被换出的页。而且在swap时做了一些assert检查。

## 实验中的知识点

page fault的处理流程表现的非常详细，很好地解答了本节一开始的问题——如何判断一个页访问异常是缺页异常。构建了页表项到磁盘扇区的映射关系表示法。

## 原理课中的知识点

原理课中提到的全局置换算法，在这里没有体现。主要因为此时的ucore还没有进程的概念，没有实现全局置换算法的基石。

